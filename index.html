<!DOCTYPE html>
<html>
<head>
  <title>Stroop Task Experiment</title>
  <script src="https://unpkg.com/jspsych@7.3.4"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe@0.4"></script>
  <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet">
</head>
<body></body>
<script>
const jsPsych = initJsPsych({
  on_finish: function() {
    jsPsych.data.displayData();
  }
});

const colors = ['red', 'blue', 'green'];
let trials = [];

colors.forEach(word => {
  colors.forEach(color => {
    for (let i = 0; i < 2; i++) {
      trials.push({ word: word, color: color });
    }
  });
});

trials = jsPsych.randomization.shuffle(trials);

const instructions = {
  type: jsPsychHtmlButtonResponse,
  stimulus: '<p><strong>Welcome to the Stroop Challenge!</strong></p>' +
            '<p>Test your reaction speed and focus by determining if the color of the word matches its meaning.</p>' +
            '<p>Click MATCH if they match, NOT if they don\'t.</p>' +
            '<p>Press Start when you\'re ready!</p>',
  choices: ['Start']
};

const ready_screen = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: '<p>Take a deep breath. Get ready for the next round.</p><p>Press any key to continue.</p>',
  post_trial_gap: 500
};

const stroop_trial = {
  type: jsPsychHtmlButtonResponse,
  stimulus: function() {
    let trial = jsPsych.timelineVariable('trial');
    let fontSize = Math.floor(Math.random() * 20) + 40;
    return `<p style='color:${trial.color}; font-size: ${fontSize}px; font-weight:bold;'>${trial.word.toUpperCase()}</p>`;
  },
  choices: ['MATCH', 'NOT'],
  data: function() {
    let trial = jsPsych.timelineVariable('trial');
    return {
      word: trial.word,
      color: trial.color,
      congruent: trial.word === trial.color ? 1 : 0
    };
  },
  on_finish: function(data) {
    data.correct = (data.congruent === 1 && data.response === 0) || (data.congruent === 0 && data.response === 1);
  }
};

  const save_data = {
    type: jsPsychPipe,
    action: "save",
    experiment_id: "zenXLoyKXbE6",
    filename: "stroop_data.csv",
    data_string: () => jsPsych.data.get().csv(),
  };

  const trial_timeline = {
    timeline: [ready, stroop],
    timeline_variables: trials.map(trial => ({ trial: trial }))
  };

  const timeline = [instructions, trial_timeline, save_data];

  jsPsych.run(timeline);
</script>
</html>
